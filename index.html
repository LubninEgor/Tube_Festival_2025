<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Tube Festival 2025 - –§–∏–∫—Å –∫–∞–º–µ—Ä—ã</title>
    
    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É WebGL
        function checkWebGLSupport() {
            try {
                const canvas = document.createElement('canvas');
                return !!(
                    window.WebGLRenderingContext &&
                    (canvas.getContext('webgl') || canvas.getContext('experimental-webgl'))
                );
            } catch (e) {
                return false;
            }
        }
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ, –µ—Å–ª–∏ WebGL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è
        if (!checkWebGLSupport()) {
            alert("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebGL. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å –±—Ä–∞—É–∑–µ—Ä –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Chrome/Firefox.");
        }
    </script>
    
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            touch-action: none;
        }
        
        /* –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            z-index: 10000;
            text-align: center;
            padding: 20px;
        }
        
        .logo {
            width: 150px;
            height: 150px;
            margin-bottom: 20px;
            border-radius: 50%;
            background: radial-gradient(circle, #4cc9f0 0%, #4361ee 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 70px;
            color: white;
            box-shadow: 0 0 30px rgba(76, 201, 240, 0.7);
        }
        
        .title {
            font-size: 28px;
            margin-bottom: 15px;
            background: linear-gradient(45deg, #4cc9f0, #f72585);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
        }
        
        .instructions {
            font-size: 18px;
            margin-bottom: 30px;
            max-width: 500px;
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        .btn {
            padding: 16px 50px;
            font-size: 20px;
            background: linear-gradient(45deg, #4361ee, #4cc9f0);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin-top: 20px;
            box-shadow: 0 5px 25px rgba(67, 97, 238, 0.5);
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s ease;
        }
        
        .btn:hover, .btn:active {
            transform: scale(1.05);
            box-shadow: 0 7px 30px rgba(67, 97, 238, 0.7);
        }
        
        .warning {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 193, 7, 0.15);
            border-radius: 10px;
            max-width: 500px;
            font-size: 14px;
        }
        
        .hidden {
            display: none;
        }
        
        /* –≠–∫—Ä–∞–Ω –∫–∞–º–µ—Ä—ã */
        .camera-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9000;
        }
        
        /* –ú–∞—Ä–∫–µ—Ä –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .test-marker {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 180px;
            border: 3px solid white;
            border-radius: 15px;
            background: url('https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png') center/contain no-repeat;
            z-index: 10000;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.6);
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è */
        .detection-indicator {
            position: absolute;
            top: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #ff3b30;
            z-index: 10000;
            box-shadow: 0 0 20px rgba(255, 59, 48, 0.7);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }
        
        .detection-indicator.found {
            background-color: #4cd964;
            box-shadow: 0 0 30px rgba(76, 217, 100, 0.7);
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .indicator-label {
            position: absolute;
            top: 85px;
            right: 15px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 16px;
            z-index: 10000;
            min-width: 180px;
            text-align: center;
        }
        
        .status-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 15px;
            background: rgba(0,0,0,0.6);
            display: flex;
            justify-content: space-between;
            z-index: 10000;
            font-size: 16px;
        }
        
        .debug-info {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0,0,0,0.6);
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            z-index: 10000;
            max-width: 90%;
        }
        
        /* –î–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ iOS */
        @supports (-webkit-touch-callout: none) {
            .btn {
                padding: 20px 55px;
            }
        }
    </style>
</head>
<body>
    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div class="start-screen" id="startScreen">
        <div class="logo">üöÄ</div>
        <h1 class="title">Tube Festival 2025</h1>
        <p class="instructions">
            –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä Hiro, —á—Ç–æ–±—ã –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å AR-–æ–ø—ã—Ç. –î–ª—è —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ.
        </p>
        
        <button class="btn" id="startBtn">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ö–ê–ú–ï–†–£</button>
        
        <div class="warning">
            ‚ö†Ô∏è –ï—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—ã —Ä–∞–∑—Ä–µ—à–∏–ª–∏ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.
            –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ Chrome –∏–ª–∏ Firefox.
        </div>
    </div>
    
    <!-- –≠–∫—Ä–∞–Ω –∫–∞–º–µ—Ä—ã -->
    <div class="camera-screen hidden" id="cameraScreen">
        <div class="status-bar">
            <div>Tube Festival 2025</div>
            <div id="cameraStatus">–û–∂–∏–¥–∞–Ω–∏–µ –∫–∞–º–µ—Ä—ã...</div>
        </div>
        
        <div class="detection-indicator" id="detectionIndicator">üîç</div>
        <div class="indicator-label" id="indicatorLabel">–ü–æ–∏—Å–∫ –º–∞—Ä–∫–µ—Ä–∞</div>
        
        <div class="test-marker"></div>
        
        <div class="debug-info" id="debugInfo"></div>
        
        <button class="btn" id="restartBtn" style="position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);">
            –ü–ï–†–ï–ó–ê–ü–£–°–¢–ò–¢–¨
        </button>
    </div>

    <!-- AR —Å—Ü–µ–Ω–∞ -->
    <a-scene
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        id="arScene"
        style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: none;"
        renderer="logarithmicDepthBuffer: true; precision: medium; alpha: true; antialias: true;"
        webxr
    >
        <!-- –ü—Ä–æ—Å—Ç–æ–π –∫—É–± –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <a-marker type="pattern" preset="hiro">
            <a-box 
                position="0 0.5 0" 
                scale="0.5 0.5 0.5" 
                color="#4361ee"
                animation="property: rotation; to: 0 360 0; loop: true; dur: 5000"
            ></a-box>
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const startScreen = document.getElementById('startScreen');
        const cameraScreen = document.getElementById('cameraScreen');
        const startBtn = document.getElementById('startBtn');
        const restartBtn = document.getElementById('restartBtn');
        const detectionIndicator = document.getElementById('detectionIndicator');
        const indicatorLabel = document.getElementById('indicatorLabel');
        const cameraStatus = document.getElementById('cameraStatus');
        const debugInfo = document.getElementById('debugInfo');
        const arScene = document.getElementById('arScene');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        let cameraStarted = false;
        let stream = null;
        let detectionCount = 0;
        
        // –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –∫–∞–º–µ—Ä–æ–π
        startBtn.addEventListener('click', startCamera);
        restartBtn.addEventListener('click', restartApp);
        
        function startCamera() {
            // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –∫–∞–º–µ—Ä—ã
            startScreen.classList.add('hidden');
            cameraScreen.classList.remove('hidden');
            arScene.style.display = 'block';
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–∏ getUserMedia
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showError("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ");
                return;
            }
            
            // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞–º–µ—Ä—ã
            const constraints = {
                video: {
                    facingMode: 'environment',
                    width: { ideal: 1280 },
                    height: { ideal: 720 },
                    frameRate: { ideal: 30 }
                }
            };
            
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ
            navigator.mediaDevices.getUserMedia(constraints)
                .then(handleCameraSuccess)
                .catch(handleCameraError);
        }
        
        function handleCameraSuccess(mediaStream) {
            cameraStarted = true;
            stream = mediaStream;
            cameraStatus.textContent = "–ö–∞–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–∞";
            debugInfo.textContent = "–ö–∞–º–µ—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞";
            
            // –î–ª—è Safari: –¥–æ–±–∞–≤–ª—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
            if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
                const videoElement = document.querySelector('video');
                if (videoElement) {
                    videoElement.setAttribute('playsinline', 'true');
                    videoElement.setAttribute('webkit-playsinline', 'true');
                }
            }
        }
        
        function handleCameraError(error) {
            let errorMessage = "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã";
            
            if (error.name === 'NotAllowedError') {
                errorMessage = "–î–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ –∑–∞–ø—Ä–µ—â—ë–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ä–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±—Ä–∞—É–∑–µ—Ä–∞.";
            } else if (error.name === 'NotFoundError') {
                errorMessage = "–ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–º–µ–µ—Ç –∫–∞–º–µ—Ä—É.";
            } else if (error.name === 'NotReadableError') {
                errorMessage = "–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω–∞ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥—Ä—É–≥–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.";
            } else if (error.name === 'OverconstrainedError') {
                errorMessage = "–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–º–µ—Ä—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.";
            } else if (error.name === 'SecurityError') {
                errorMessage = "–û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ø–æ HTTPS.";
            }
            
            showError(errorMessage);
        }
        
        function showError(message) {
            cameraStatus.textContent = "–û—à–∏–±–∫–∞";
            cameraStatus.style.color = "#ff6b6b";
            indicatorLabel.textContent = message;
            indicatorLabel.style.color = "#ff6b6b";
            detectionIndicator.style.backgroundColor = "#ff6b6b";
            debugInfo.textContent = message;
        }
        
        function restartApp() {
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Ç—Ä–µ–∫–∏ –∫–∞–º–µ—Ä—ã
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
            location.reload();
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateDebugInfo() {
            const info = [
                `–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${navigator.platform}`,
                `–ë—Ä–∞—É–∑–µ—Ä: ${navigator.userAgent}`,
                `–û–Ω–ª–∞–π–Ω: ${navigator.onLine ? '–î–∞' : '–ù–µ—Ç'}`,
                `–ö–∞–º–µ—Ä–∞: ${cameraStarted ? '–ê–∫—Ç–∏–≤–Ω–∞' : '–ù–µ–∞–∫—Ç–∏–≤–Ω–∞'}`,
                `–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–π: ${detectionCount}`
            ];
            
            debugInfo.innerHTML = info.join('<br>');
        }
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ AR
        function checkARSupport() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–∞–∑–æ–≤—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É
            if (!checkWebGLSupport()) {
                showError("WebGL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –û–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä.");
                return false;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ getUserMedia
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showError("–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ");
                return false;
            }
            
            return true;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', () => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É AR
            checkARSupport();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(updateDebugInfo, 2000);
            
            // –î–ª—è iOS: –¥–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
            if (navigator.userAgent.match(/iPhone|iPad|iPod/i)) {
                document.body.classList.add('ios-device');
                debugInfo.textContent = "iOS —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏";
            }
        });
    </script>
</body>
</html>